# TODO

## 환경 설정 및 도구
- [x] pnpm 워크스페이스 구조(`apps/extension`, `apps/web`, `packages/core`) 초기화.
- [x] 공통 TypeScript, ESLint, Prettier, Vitest 기반 설정 구성.
- [x] `.env.example` 추가 및 Free Plan에서 원격 DB 없이 IndexedDB 사용 방법 문서화.
- [x] 초기 스캐폴딩 검증을 위해 lint와 타입 체킹 실행.

## 브라우저 확장 - 단어 수집
- [x] 수집 플로우 설계서 작성: 사용자 이벤트 → 메시지 → 캐시 저장까지의 순서 다이어그램과 오류/오프라인 시나리오 정리.
- [x] `content.js` 선택 감지 모듈 구현: 더블클릭·드래그 이벤트 리스너, 텍스트 정규화, 주변 문장 2개 범위 문맥 추출, 중복 선택 차단 로직.
- [x] `content.js` 상태 관리 구성: 선택/로딩/성공/실패 상태, 토스트 메시지, 다국어·다크 모드 스타일 토큰 정의.
- [x] Shadow DOM 툴팁 UI 제작: 단어·문맥 미리보기, 저장/취소/즐겨찾기 버튼, Enter/Esc 단축키 지원, 시각적 피드백 애니메이션.
- [x] `background.js` 메시지 파이프 구축: 요청 큐 관리, 동일 단어 연속 요청 디바운스, 재시도 백오프와 네트워크 오류 핸들링.
- [x] 수집 페이로드 스키마 정의 및 검증: 단어·원문 URL·문맥 범위·선택 시각·사용자 메모 필드 포함, `packages/core` 타입과 동기화.
- [x] declarativeNetRequest 규칙 구성: 허용 도메인 화이트리스트, referer 헤더 자동 설정, 규칙 버전 관리 스크립트 작성.
- [x] IndexedDB 저장 어댑터 연동: 성공/실패 콜백, 오프라인 큐(pending 스토어) 처리, 캐시 용량 초과 시 LRU 삭제.
- [x] 관측/로그 수집: Sentry breadcrumb 추가, 사용자 이벤트 로깅, 주요 오류 메시지 현지화.
- [x] 테스트: 텍스트 정규화·문맥 추출 단위 테스트, 메시지 큐 디바운스 테스트, Playwright 선택→툴팁→저장 E2E, 오프라인 재시도 수동 검증 체크리스트.

## 공유 캐시 및 코어 로직
- [x] 데이터 사전 작성: `WordEntry`, `ContextSnapshot`, `ReviewState`, `QuizSession`, `PendingRequest` 엔티티와 필수/옵션 속성, ID 전략 문서화.
- [x] IndexedDB 스키마 설계: 단어/문맥/복습/퀴즈 세션/설정/대기열 스토어 정의, 복합 인덱스와 버전 업그레이드 단계 수립.
- [x] Dexie 기반 레포지토리 구현: 트랜잭션 유틸, CRUD(`upsertWordWithContext`, `markKnown`, `getDueReviews`, `popPendingRequest`), 오류 코드 표준화.
- [x] 공통 비즈니스 서비스 구현: 중복 병합·수동 수정 우선 규칙, 문맥 병합 기준, 삭제 플래그 및 복원 로직.
- [x] 고수준 도메인 API 작성: CSV/SRS/광고 모듈이 재사용할 필터링·페이징·정렬·DTO 변환 함수 제공.
- [x] 캐시 동기화 훅: 확장·웹 간 브로드캐스트 채널/IndexedDB 변경 이벤트 대응, 실시간 UI 반영 훅 구현.
- [x] 오류 복구 및 백업 전략: 캐시 스냅샷 내보내기/가져오기, 손상 감지 시 초기화/복구 흐름 정의.
- [x] 개발 편의 도구: 더미 데이터 시드 스크립트, 개발자용 IndexedDB 상태 확인 콘솔 명령.
- [x] 테스트: 데이터 모델 스냅샷 테스트, Dexie 레포지토리 단위/통합 테스트, 캐시 동기화 브로드캐스트 테스트, 대용량 데이터 성능 측정, 복구 플로우 수동 체크리스트.

## 웹 앱 - 단어장 관리
- [ ] 라우팅과 Zustand 상태 훅을 포함한 Preact UI 스캐폴딩.
- [ ] 목록/검색/필터, 상세 보기, 수정/삭제 상호작용 구현.
- [ ] 테스트: 컴포넌트 단위 테스트, 캐시 데이터를 기반으로 한 Playwright CRUD 플로우 검증.

## SRS 스케줄러 엔진
- [ ] 코어 패키지에 SM-2 스타일 스케줄러와 복습 큐 생성기 구현.
- [ ] 복습 상태 갱신을 IndexedDB에 지속적으로 반영.
- [ ] 테스트: 샘플 진행 데이터를 활용한 알고리즘 단위 테스트, 캐시 연동 테스트.

## 퀴즈 경험
- [ ] 예정된 항목을 불러오는 퀴즈 세션 생성기 구축.
- [ ] 카드/타자 입력 컴포넌트와 피드백 흐름 구현.
- [ ] 결과 처리를 스케줄러 갱신 서비스와 연결.
- [ ] 테스트: 컴포넌트 테스트, 상태 변화를 확인하는 엔드 투 엔드 퀴즈 세션.

## CSV 내보내기
- [x] 단어장 데이터 CSV 내보내기(크롬 downloads API 사용)
- [x] 저장 파일명/인코딩 설정
- [ ] 테스트: 대용량/특수문자 케이스

## 광고 모듈 (Free Plan)
- [ ] 퀴즈 UI 배너 슬롯과 CSV 다운로드 전 리워드 흐름(모킹 SDK) 연동.
- [ ] 노출 빈도 제어와 옵션 해제 플래그 구성.
- [ ] 테스트: 컴포넌트 스냅샷, 모킹 SDK 상호작용 테스트, 수동 광고 검수 체크리스트.

## 통합 및 QA
- [ ] Playwright E2E: 수집 → 관리 → 복습 → 퀴즈 → CSV → 광고 전체 흐름.
- [ ] IndexedDB 쿼리 성능과 캐시 용량 동작 점검.
- [ ] Sentry 계측 스모크 테스트.

## 배포 및 운영
- [ ] Vite 산출물을 포함한 GitHub Actions 파이프라인(lint → test → build) 구성.
- [ ] 웹 앱용 Firebase Hosting 자동 배포.
- [ ] 확장용 Chrome Web Store 패키징/업로드 자동화 준비.

## Pro Plan 준비
- [ ] Firebase Auth/Firestore 스키마와 동기화 전략 초안 작성.
- [ ] 로컬 캐시에서 Pro 기능으로 전환되는 게이팅 및 마이그레이션 단계 설계.
- [ ] Pro 업그레이드 롤아웃/테스트 계획 문서화.
## 사전 조회/발음 (영한사전)
- [ ] 네이버 enko API 조회용 백그라운드 라우팅 추가 및 Referer DNR 규칙 확인.
- [ ] 더블클릭/드래그 선택 트리거로 단어→뜻/IPA/오디오 URL 조회 흐름 완성.
- [ ] Tooltip UI에 IPA(//) 표기 및 발음 재생 버튼 추가(오디오 URL 존재 시 활성화).
- [ ] 백그라운드에서 IPA/audioUrl 보강(dictionaryapi.dev) 병합 로직 구현.
- [ ] content ? background 메시지(CHECKVOCA_LOOKUP) 정의 및 에러 처리.
- [ ] 테스트: 네트워크 mocking 기반 정의/오디오 조회, Tooltip 상태 전이 테스트.

